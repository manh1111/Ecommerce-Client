import{j as e}from"./mui-d65b584a.js";import{g as d,u as v,c as k,d as S,L as C,S as p,f as _,Q as t,D as U}from"./index-f39d8328.js";import{m as P,P as E,a as F}from"./auth-a2d1c8ae.js";import{r as m,$ as o}from"./antd-87a612df.js";const Y=async(n,i)=>await d.post("http://localhost:8080/v1/api/auth/verifyUser",{email:n,otp:i}),q=async n=>await d.post("http://localhost:8080/v1/api/otp/send-otp",{email:n}),L=()=>{const[n,i]=m.useState(!1),[c,h]=m.useState(""),[u,x]=m.useState(""),{width:g}=v(),f=k(),{register:l,handleSubmit:N,formState:{errors:a},control:b,watch:j}=S({defaultValues:{email:"",password:"",password_again:"",name:"",phoneNumber:""},mode:"onBlur",criteriaMode:"all",reValidateMode:"onChange"}),w=async s=>{try{const r=await F(s.name,s.name,s.phoneNumber,s.email,s.password);r.status===201?(x(s.email),(await q(s.email)).status===200?(i(!0),t.success("OTP đã được gửi đến email của bạn.")):t.error("Không thể gửi OTP. Vui lòng thử lại.")):r.status===409?t.error("Tài khoản đã tồn tại."):r.status===500&&t.error("Không đăng kí được tài khoản. Vui lòng thử lại.")}catch{t.error("Đăng ký thất bại! Vui lòng kiểm tra lại thông tin.")}},y=async()=>{try{(await Y(u,c)).status===200?(t.success("Xác thực thành công! Đang chuyển hướng..."),f("/")):t.error("Mã xác nhận không đúng, vui lòng thử lại.")}catch{t.error("Xác thực thất bại, vui lòng thử lại.")}};return e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 4xl:grid-cols-[minmax(0,_1030px)_minmax(0,_1fr)]",children:[g>=1024&&e.jsxs("div",{className:"flex flex-col justify-center items-center lg:p-[60px]",children:[e.jsx(C,{imgClass:"w-[60px]",textClass:"text-[28px]"}),e.jsx("p",{className:"text-center tracking-[0.2px] font-semibold text-lg leading-6 max-w-[540px] my-7 mx-auto",children:"Discover trends, track your orders effortlessly, and enhance your shopping experience."}),e.jsx("img",{className:"max-w-[780px]",src:P,alt:"media"})]}),e.jsx("div",{className:"bg-widget flex items-center justify-center w-full py-10 px-4 lg:p-[60px]",children:n?e.jsx(p,{className:"max-w-[460px] w-full",type:"slideUp",duration:400,delay:300,children:e.jsxs("div",{children:[e.jsx("h2",{className:"title-sign",children:"Xác nhận mã"}),e.jsx("p",{children:"Để đảm bảo đây chính là email của bạn, hãy nhập mã mà chúng tôi đã gửi qua email."}),e.jsx("input",{type:"text",placeholder:"FB-",className:"field-input",value:c,onChange:s=>h(s.target.value)}),e.jsx("button",{className:"btn btn--primary w-full mt-5",onClick:y,children:"Cập nhật thông tin liên hệ"}),e.jsx("button",{className:"btn btn--secondary w-full mt-3",onClick:()=>i(!1),children:"Quay lại trang trước"})]})}):e.jsx(p,{className:"max-w-[460px] w-full",type:"slideUp",duration:400,delay:300,children:e.jsxs("form",{className:"mt-5",onSubmit:N(w),children:[e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"name",className:"field-label",children:"Name"}),e.jsx("input",{className:o("field-input",{"field-input--error":a.name}),id:"name",type:"text",placeholder:"Your name",...l("name",{required:"Yêu cầu nhập họ tên",minLength:{value:5,message:"Phải chứa ít nhất 5 kí tự"}})}),a.name&&e.jsx("span",{className:"text-red-500 text-base",children:a.name.message})]}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"phoneNumber",className:"field-label",children:"Phone Number"}),e.jsx("input",{className:o("field-input",{"field-input--error":a.phoneNumber}),id:"phoneNumber",type:"text",placeholder:"Your phone number",...l("phoneNumber",{required:"Yêu cầu số điện thoại",pattern:{value:/^\d+$/,message:"Số điện thoại chỉ được chứa số"},minLength:{value:8,message:"Phải chứa ít nhất 8 số"}})}),a.phoneNumber&&e.jsx("span",{className:"text-red-500 text-base",children:a.phoneNumber.message})]}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"email",className:"field-label",children:"E-mail"}),e.jsx("input",{className:o("field-input",{"field-input--error":a.email}),id:"email",type:"text",placeholder:"Your E-mail address",...l("email",{required:!0,pattern:{value:/^\S+@\S+$/i,message:"Email không hợp lệ"}})}),a.email&&e.jsx("span",{className:"text-red-500 text-base",children:a.email.message})]}),e.jsx(_,{name:"password",control:b,rules:{required:"Yêu cầu mật khẩu",minLength:{value:8,message:"Mật khẩu phải có ít nhất 8 ký tự"}},render:({field:s})=>e.jsx(E,{id:"password",placeholder:"Your password",error:a.password,innerRef:s.ref,isInvalid:a.password,value:s.value,onChange:s.onChange})}),a.password&&e.jsx("span",{className:"text-red-500 text-base",children:a.password.message}),e.jsxs("div",{className:"field-wrapper",children:[e.jsx("label",{htmlFor:"password_again",className:"field-label",children:"Nhập lại mật khẩu"}),e.jsx("input",{className:o("field-input",{"field-input--error":a.password_again}),id:"password_again",type:"password",placeholder:"Nhập lại mật khẩu",...l("password_again",{required:"Bắt buộc phải nhập lại mật khẩu",validate:s=>s===j("password")||"Mật khẩu không khớp, vui lòng nhập lại"})}),a.password_again&&e.jsx("span",{className:"text-red-500 text-base",children:a.password_again.message})]})]}),e.jsx("div",{className:"flex flex-col items-center gap-6 mt-4 mb-10",children:e.jsx("button",{className:"btn btn--primary w-full mt-5",type:"submit",children:"Sign Up"})})]})})})]})},B=()=>e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Sign up"}),e.jsx(L,{})]});export{B as default};
